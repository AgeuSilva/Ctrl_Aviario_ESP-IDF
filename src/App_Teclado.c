/*=============================================================================================================================
    Init Includes Files ANSI C
=============================================================================================================================*/
#include <stdio.h>
#include <stdlib.h>
#include <stddef.h>
#include <string.h>
#include <stdbool.h>
#include "_ansi.h"
/*=============================================================================================================================
    End Includes Files ANSI C
=============================================================================================================================*/

/*=============================================================================================================================
    Init Includes Files ESP32
=============================================================================================================================*/
#include <esp_system.h>
#include <nvs_flash.h>
#include <esp_event_loop.h>
#include <esp_log.h>
#include "driver/gpio.h"
#include <driver/ledc.h>
/*=============================================================================================================================
    End Includes Files ESP32
=============================================================================================================================*/

/*=============================================================================================================================
    Init Include Files Controle do Teclado
=============================================================================================================================*/
#include "App_Teclado.h"
/*=============================================================================================================================
    End Include Files Controle do Teclado
=============================================================================================================================*/

/*=============================================================================================================================
    Init Defines
=============================================================================================================================*/
#define TECLA_1 33
#define TECLA_2 32
#define TECLA_3 35
#define TECLA_4 34

#define TECLA_1_PRESSIONADA() (gpio_get_level(TECLA_1) == 0)
#define TECLA_2_PRESSIONADA() (gpio_get_level(TECLA_2) == 0)
#define TECLA_3_PRESSIONADA() (gpio_get_level(TECLA_3) == 0)
#define TECLA_4_PRESSIONADA() (gpio_get_level(TECLA_4) == 0)
/*=============================================================================================================================
    End Defines
=============================================================================================================================*/

/*=============================================================================================================================
    Init Handle of Task
=============================================================================================================================*/
TaskHandle_t xTeclado = 0;
/*=============================================================================================================================
    End Handle of Task
=============================================================================================================================*/

void vConfigTeclado(void)
{
    gpio_pad_select_gpio(TECLA_1);
    gpio_set_direction(TECLA_1 , GPIO_MODE_INPUT);
    gpio_pad_select_gpio(TECLA_2);
    gpio_set_direction(TECLA_2 , GPIO_MODE_INPUT);
    gpio_pad_select_gpio(TECLA_3);
    gpio_set_direction(TECLA_3 , GPIO_MODE_INPUT);
    gpio_pad_select_gpio(TECLA_4);
    gpio_set_direction(TECLA_4 , GPIO_MODE_INPUT);

    xTaskCreate(&vTeclado, "vTeclado", configMINIMAL_STACK_SIZE + 4096, NULL, 1, xTeclado);
}

void vAppTeclado(void)
{
    while (true)
    { 
        if(TECLA_1_PRESSIONADA())
        {
            vTaskDelay(pdMS_TO_TICKS(20));
            if(TECLA_1_PRESSIONADA())
            {
                ESP_LOGE("PRESSIONADO", "Tecla 1 \r\n");
            }

            while(TECLA_1_PRESSIONADA())
            {
            }
        }

        if(TECLA_2_PRESSIONADA())
        {
            vTaskDelay(pdMS_TO_TICKS(20));
            if(TECLA_2_PRESSIONADA())
            {
                ESP_LOGE("PRESSIONADO", "Tecla 2 \r\n");
            }

            while(TECLA_2_PRESSIONADA())
            {
            }
        }

        if(TECLA_3_PRESSIONADA())
        {
            vTaskDelay(pdMS_TO_TICKS(20));
            if(TECLA_3_PRESSIONADA())
            {
                ESP_LOGE("PRESSIONADO", "Tecla 3 \r\n");
            }

            while(TECLA_3_PRESSIONADA())
            {
            }
        }

        if(TECLA_4_PRESSIONADA())
        {
            vTaskDelay(pdMS_TO_TICKS(20));
            if(TECLA_4_PRESSIONADA())
            {
                ESP_LOGE("PRESSIONADO", "Tecla 4 \r\n");
            }

            while(TECLA_4_PRESSIONADA())
            {
            }
        }

        vTaskDelay(pdMS_TO_TICKS(10)); /* Delay de 1 mili segundos */
    }
}

/*=============================================================================================================================
    Init Tasks FreeRTOS
=============================================================================================================================*/
void vTeclado(void *pvParameter)
{
    (void) pvParameter;
    vAppTeclado();
}
/*=============================================================================================================================
    End Tasks FreeRTOS
=============================================================================================================================*/